import 'package:dartlin/control_flow.dart';
import 'package:path/path.dart';
import 'package:sisolab_flutter_biosafety/app/data/models/bio_io.dart';
import 'package:sisolab_flutter_biosafety/app/data/models/select_proc_list_in.dart';
import 'package:sisolab_flutter_biosafety/core/utils/mc_logger.dart';
import 'package:sqflite/sqflite.dart';

class SqfliteProvider  {
  static late final Database db;
  static final pLog = PLogger(prefix: "SqfliteProvider");
  static const tbNm = "io";

  static Future<int> merge(BioIo io) async {
    pLog.i("insert ${io.localId}");

    return await db.insert(tbNm, io.toJson(),
        conflictAlgorithm: ConflictAlgorithm.replace);
  }

  static Future<int> delete(int localId) async {
    pLog.i("delete $localId");
    return await db.delete(tbNm, where: "localId = $localId");
  }

  // localRegDateTime
  static Future<List<BioIo>> selectList(SelectProcListIn req) async {
    return (await db.query("io", where: '''
        gbn='${req.gbn.name}' 
        ${req.searchCompany != null && req.searchCompany!.isNotEmpty ? "AND company LIKE '%${req.searchCompany}%'" : ''}
        
        ${req.searchDate1 != null ? "AND datetime(localRegDateTime) >= datetime('${req.searchDate1!}')" : ''}
        ${req.searchDate2 != null ? "AND datetime(localRegDateTime) <= datetime('${req.searchDate2!}')" : ''}
          
      ''')).let((it) {
      pLog.i(it);
        return List.generate(it.length, (i) => BioIo.fromJson(it[i]));
      });
  }

  static Future<BioIo> select(int localId) async => BioIo.fromJson(
      (await db.query("io", where: 'localId = ?', whereArgs: [localId])).first);

  static Future<void> init() async {

    // await deleteDatabase(join(await getDatabasesPath(), 'bio_database.db'));
    db = await openDatabase(join(await getDatabasesPath(), 'bio_database.db'),
        version: 2, onCreate: (db, _) {
      return db.execute('''
CREATE TABLE $tbNm ( 
  localId INTEGER primary key autoincrement,
  localRegDateTime text, 
  localUpdDateTime text, 
  attNameTxt1 text,
attNameTxt10 text,
attNameTxt11 text,
attNameTxt12 text,
attNameTxt13 text,
attNameTxt14 text,
attNameTxt15 text,
attNameTxt16 text,
attNameTxt17 text,
attNameTxt18 text,
attNameTxt19 text,
attNameTxt2 text,
attNameTxt20 text,
attNameTxt3 text,
attNameTxt4 text,
attNameTxt5 text,
attNameTxt6 text,
attNameTxt7 text,
attNameTxt8 text,
attNameTxt9 text,
attfile10str text,
attfile11str text,
attfile12str text,
attfile13str text,
attfile14str text,
attfile15str text,
attfile16str text,
attfile17str text,
attfile18str text,
attfile19str text,
attfile1str text,
attfile20str text,
attfile21str text,
attfile22str text,
attfile23str text,
attfile24str text,
attfile25str text,
attfile26str text,
attfile27str text,
attfile28str text,
attfile29str text,
attfile2str text,
attfile30str text,
attfile31str text,
attfile32str text,
attfile33str text,
attfile34str text,
attfile35str text,
attfile36str text,
attfile37str text,
attfile38str text,
attfile39str text,
attfile3str text,
attfile40str text,
attfile41str text,
attfile42str text,
attfile43str text,
attfile44str text,
attfile45str text,
attfile46str text,
attfile47str text,
attfile48str text,
attfile49str text,
attfile4str text,
attfile5str text,
attfile6str text,
attfile7str text,
attfile8str text,
attfile9str text,
comAddress text,
comCode text,
comName text,
company text,
d1 text,
d10 text,
d100 text,
d101 text,
d102 text,
d103 text,
d104 text,
d105 text,
d106 text,
d107 text,
d108 text,
d109 text,
d11 text,
d110 text,
d111 text,
d112 text,
d113 text,
d114 text,
d115 text,
d116 text,
d117 text,
d118 text,
d119 text,
d12 text,
d120 text,
d121 text,
d122 text,
d123 text,
d124 text,
d125 text,
d126 text,
d127 text,
d128 text,
d129 text,
d13 text,
d130 text,
d131 text,
d132 text,
d133 text,
d134 text,
d135 text,
d136 text,
d137 text,
d138 text,
d139 text,
d14 text,
d140 text,
d141 text,
d142 text,
d143 text,
d144 text,
d145 text,
d146 text,
d147 text,
d148 text,
d149 text,
d15 text,
d150 text,
d151 text,
d152 text,
d153 text,
d154 text,
d155 text,
d156 text,
d157 text,
d158 text,
d159 text,
d16 text,
d160 text,
d161 text,
d162 text,
d163 text,
d164 text,
d165 text,
d166 text,
d167 text,
d168 text,
d169 text,
d17 text,
d170 text,
d171 text,
d172 text,
d173 text,
d174 text,
d175 text,
d176 text,
d177 text,
d178 text,
d179 text,
d18 text,
d180 text,
d181 text,
d182 text,
d183 text,
d184 text,
d185 text,
d186 text,
d187 text,
d188 text,
d189 text,
d19 text,
d190 text,
d191 text,
d192 text,
d193 text,
d194 text,
d195 text,
d196 text,
d197 text,
d198 text,
d199 text,
d2 text,
d20 text,
d200 text,
d201 text,
d202 text,
d203 text,
d204 text,
d205 text,
d206 text,
d207 text,
d208 text,
d209 text,
d21 text,
d210 text,
d211 text,
d212 text,
d213 text,
d214 text,
d215 text,
d216 text,
d217 text,
d218 text,
d219 text,
d22 text,
d220 text,
d221 text,
d222 text,
d223 text,
d224 text,
d225 text,
d226 text,
d227 text,
d228 text,
d229 text,
d23 text,
d230 text,
d231 text,
d232 text,
d233 text,
d234 text,
d235 text,
d236 text,
d237 text,
d238 text,
d239 text,
d24 text,
d240 text,
d241 text,
d242 text,
d243 text,
d244 text,
d245 text,
d246 text,
d247 text,
d248 text,
d249 text,
d25 text,
d250 text,
d251 text,
d252 text,
d253 text,
d254 text,
d255 text,
d256 text,
d257 text,
d258 text,
d259 text,
d26 text,
d260 text,
d261 text,
d262 text,
d263 text,
d264 text,
d265 text,
d266 text,
d267 text,
d268 text,
d269 text,
d27 text,
d270 text,
d271 text,
d272 text,
d273 text,
d274 text,
d275 text,
d276 text,
d277 text,
d278 text,
d279 text,
d28 text,
d280 text,
d281 text,
d282 text,
d283 text,
d284 text,
d285 text,
d286 text,
d287 text,
d288 text,
d289 text,
d29 text,
d290 text,
d291 text,
d292 text,
d293 text,
d294 text,
d295 text,
d296 text,
d297 text,
d298 text,
d299 text,
d3 text,
d30 text,
d300 text,
d301 text,
d302 text,
d303 text,
d304 text,
d305 text,
d306 text,
d307 text,
d308 text,
d309 text,
d31 text,
d310 text,
d311 text,
d312 text,
d313 text,
d314 text,
d315 text,
d316 text,
d317 text,
d318 text,
d319 text,
d32 text,
d320 text,
d321 text,
d322 text,
d323 text,
d324 text,
d325 text,
d326 text,
d327 text,
d328 text,
d329 text,
d33 text,
d330 text,
d331 text,
d332 text,
d333 text,
d334 text,
d335 text,
d336 text,
d337 text,
d338 text,
d339 text,
d34 text,
d340 text,
d341 text,
d342 text,
d343 text,
d344 text,
d345 text,
d346 text,
d347 text,
d348 text,
d349 text,
d35 text,
d350 text,
d351 text,
d352 text,
d353 text,
d354 text,
d355 text,
d356 text,
d357 text,
d358 text,
d359 text,
d36 text,
d360 text,
d361 text,
d362 text,
d363 text,
d364 text,
d365 text,
d366 text,
d367 text,
d368 text,
d369 text,
d37 text,
d370 text,
d371 text,
d372 text,
d373 text,
d374 text,
d375 text,
d376 text,
d377 text,
d378 text,
d379 text,
d38 text,
d380 text,
d381 text,
d382 text,
d383 text,
d384 text,
d385 text,
d386 text,
d387 text,
d388 text,
d389 text,
d39 text,
d390 text,
d391 text,
d392 text,
d393 text,
d394 text,
d395 text,
d396 text,
d397 text,
d398 text,
d399 text,
d4 text,
d40 text,
d400 text,
d41 text,
d42 text,
d43 text,
d44 text,
d45 text,
d46 text,
d47 text,
d48 text,
d49 text,
d5 text,
d50 text,
d51 text,
d52 text,
d53 text,
d54 text,
d55 text,
d56 text,
d57 text,
d58 text,
d59 text,
d6 text,
d60 text,
d61 text,
d62 text,
d63 text,
d64 text,
d65 text,
d66 text,
d67 text,
d68 text,
d69 text,
d7 text,
d70 text,
d71 text,
d72 text,
d73 text,
d74 text,
d75 text,
d76 text,
d77 text,
d78 text,
d79 text,
d8 text,
d80 text,
d81 text,
d82 text,
d83 text,
d84 text,
d85 text,
d86 text,
d87 text,
d88 text,
d89 text,
d9 text,
d90 text,
d91 text,
d92 text,
d93 text,
d94 text,
d95 text,
d96 text,
d97 text,
d98 text,
d99 text,
docno text,
file10editable text,
file1editable text,
file2editable text,
file3editable text,
file4editable text,
file5editable text,
file6editable text,
file7editable text,
file8editable text,
file9editable text,
gbn text,
idx text,
printSubmitDt text,
regId text,
reg_datetime text,
simAuth text,
status text,
tableName text,
attfile50str text,
attfile51str text,
attfile52str text,
attfile53str text,
attfile54str text,
attfile55str text,
attfile56str text,
attfile57str text,
attfile58str text,
attfile59str text,
attfile60str text,
attfile61str text,
attfile62str text,
attfile63str text,
attfile64str text,
attfile65str text,
attfile66str text,
attfile67str text,
attfile68str text,
attfile69str text
);
''');
    });
  }
}
